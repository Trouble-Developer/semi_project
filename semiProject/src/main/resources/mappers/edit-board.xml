<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="edu.kh.project.board.model.mapper.EditBoardMapper">

	<!-- 게시글 등록 -->
	<insert id="boardInsert" parameterType="map"
		useGeneratedKeys="true">
		<selectKey keyProperty="boardNo" order="BEFORE"
			resultType="_int">
			SELECT SEQ_BOARD_NO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO BOARD (
		BOARD_NO, BOARD_TITLE, BOARD_CONTENT,
		BOARD_WRITE_DATE, READ_COUNT,
		BOARD_DEL_FL, BOARD_LOCK,
		BOARD_CODE,
		MEMBER_NO,
		BOARD_PW
		<if test="boardCode == 3">
			,VOLUNTEER_START, VOLUNTEER_END, VOLUNTEER_CATEGORY,
			VOLUNTEER_AGENCY, VOLUNTEER_TYPE
		</if>
		)
		VALUES (
		#{boardNo},
		#{title},
		#{content},
		SYSDATE,
		DEFAULT,
		DEFAULT,
		#{boardLock},
		#{boardCode},
		#{memberNo},
		#{encPw}
		<if test="boardCode == 3">
			,#{volunteerStart}, #{volunteerEnd}, #{volunteerCategory},
			#{volunteerAgency}, #{volunteerType}
		</if>
		)
	</insert>


	<!-- 이미지 INSERT -->
	<insert id="insertUploadList" parameterType="list">
		INSERT INTO BOARD_IMG (
		IMG_NO,
		IMG_PATH,
		IMG_RENAME,
		IMG_ORIGINAL_NAME,
		IMG_ORDER,
		BOARD_NO
		)
		<foreach collection="list" item="img" separator=" UNION ALL ">
			SELECT
			NEXT_IMG_NO(),
			#{img.imgPath},
			#{img.imgRename},
			#{img.imgOriginal},
			#{img.imgOrder},
			#{img.boardNo}
			FROM DUAL
		</foreach>
	</insert>


	<!-- 게시글 등록 후 이미지 연결 -->
	<update id="updateBoardImgBoardNo">
		UPDATE BOARD_IMG
		SET BOARD_NO = #{boardNo}
		WHERE
		BOARD_NO IS NULL
	</update>

	<!-- 게시글 이미지 조회 -->
	<select id="selectBoardImgList"
		resultType="edu.kh.project.board.model.dto.BoardImg">
		SELECT *
		FROM BOARD_IMG
		WHERE BOARD_NO = #{boardNo}
		ORDER BY
		IMG_ORDER
	</select>

	<!-- 게시글 이미지 삭제 -->
	<delete id="deleteBoardImg">
		DELETE FROM BOARD_IMG
		WHERE BOARD_NO = #{boardNo}
	</delete>
	<update id="boardDelete">
		UPDATE "BOARD"
		SET BOARD_DEL_FL = 'Y'
		WHERE BOARD_NO =
		#{boardNo}
	</update>
	<update id="boardUpdate">
		UPDATE "BOARD"
		SET
		BOARD_TITLE = #{title},
		BOARD_CONTENT = #{content},
		BOARD_UPDATE_DATE = SYSDATE,
		BOARD_LOCK = #{boardLock}
		WHERE BOARD_NO = #{boardNo}
		AND BOARD_CODE = #{boardCode}
		AND MEMBER_NO = #{memberNo}
	</update>
</mapper>
